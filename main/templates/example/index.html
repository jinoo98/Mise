<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mise - 요리의 준비를 위한 모든 것</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Theme Variables -->
    <style>
        :root {
            --background: #FAFBFC;
            --foreground: #0f172a;
            --card: #ffffff;
            --card-foreground: #0f172a;
            --primary: #DC2626;
            --primary-foreground: #ffffff;
            --secondary: #FEF2F2;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --border: #e2e8f0;
            --radius: 0.75rem;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            font-family: 'Pretendard', ui-sans-serif, system-ui, -apple-system, sans-serif;
        }

        .card {
            background-color: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .tab-active {
            background-color: white;
            color: var(--foreground);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .tab-inactive {
            color: var(--muted-foreground);
        }

        .tab-inactive:hover {
            color: var(--foreground);
            background-color: rgba(0, 0, 0, 0.02);
        }

        .ingredient-tag {
            padding: 0.4rem 0.8rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .ingredient-tag.user {
            background-color: #EFF6FF;
            color: #1E40AF;
            border: 1px solid #DBEAFE;
        }

        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .modal-content::-webkit-scrollbar {
            display: none;
        }

        .spinner {
            border: 3px solid rgba(220, 38, 38, 0.1);
            border-top: 3px solid #DC2626;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-gray-100 sticky top-0 z-40">
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center gap-3">
            <div
                class="w-10 h-10 bg-red-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-red-100">
                <i data-lucide="chef-hat" class="w-6 h-6"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-gray-900 tracking-tight">Mise</h1>
                <p class="text-[10px] text-gray-400 font-medium uppercase tracking-wider">Mise En Place - 요리 준비의 모든 것
                </p>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-8">
        <!-- Tab Navigation -->
        <div class="bg-gray-100 p-1.5 rounded-2xl flex gap-1 mb-8 shadow-inner">
            <button onclick="switchTab('extractor')" id="tab-extractor"
                class="flex-1 py-3 px-4 rounded-xl text-sm transition-all flex items-center justify-center gap-2 tab-active">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                <span>AI 레시피 추출</span>
            </button>
            <button onclick="switchTab('pricing')" id="tab-pricing"
                class="flex-1 py-3 px-4 rounded-xl text-sm transition-all flex items-center justify-center gap-2 tab-inactive">
                <i data-lucide="calculator" class="w-4 h-4"></i>
                <span>단가 계산</span>
            </button>
            <button onclick="switchTab('match')" id="tab-match"
                class="flex-1 py-3 px-4 rounded-xl text-sm transition-all flex items-center justify-center gap-2 tab-inactive">
                <i data-lucide="cooking-pot" class="w-4 h-4"></i>
                <span>재료 매칭</span>
            </button>
        </div>

        <!-- Tab Content: Extractor -->
        <div id="content-extractor" class="space-y-6">
            <div class="card p-8 text-center space-y-4">
                <div
                    class="w-16 h-16 bg-red-50 text-red-600 rounded-full flex items-center justify-center mx-auto mb-2">
                    <i data-lucide="wand-2" class="w-8 h-8"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">AI에게 레시피를 물어보세요</h2>
                <p class="text-gray-500 max-w-md mx-auto">냉장고에 있는 재료를 입력하면 AI가 맛있는 요리를 제안해 드립니다.</p>

                <div class="max-w-2xl mx-auto pt-4">
                    <div class="relative">
                        <textarea id="ai-ingredients" rows="3"
                            class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-500 focus:bg-white outline-none transition-all resize-none"
                            placeholder="예: 계란, 양파, 베이컨, 파스타면"></textarea>
                    </div>
                </div>

                <div class="flex justify-center gap-4 pt-2">
                    <button onclick="generateRecipe()" id="generate-btn"
                        class="px-8 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-all flex items-center gap-2 shadow-lg shadow-red-100">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                        레시피 추천받기
                    </button>
                </div>

                <div id="ai-loading" class="hidden pt-6">
                    <div class="flex flex-col items-center gap-3">
                        <div class="spinner"></div>
                        <p class="text-sm text-gray-500 font-medium">AI가 최고의 레시피를 구상 중입니다...</p>
                    </div>
                </div>

                <div id="ai-result" class="hidden text-left card p-8 mt-8 prose prose-red max-w-none">
                    <div id="ai-recipe-content" class="text-gray-800 leading-relaxed"></div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Pricing -->
        <div id="content-pricing" class="hidden space-y-6">
            <div class="card p-8">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">레시피 원가 계산기</h2>
                        <p class="text-sm text-gray-500">각 재료의 사용량만큼의 원가를 정확히 산출합니다.</p>
                    </div>
                    <button onclick="addPricingRow()"
                        class="flex items-center gap-1 text-sm font-bold text-red-600 hover:text-red-700">
                        <i data-lucide="plus-circle" class="w-4 h-4"></i>
                        재료 추가
                    </button>
                </div>

                <div class="space-y-4">
                    <div
                        class="grid grid-cols-12 gap-4 text-xs font-bold text-gray-400 uppercase tracking-wider border-b pb-3 px-2">
                        <div class="col-span-4">재료 이름</div>
                        <div class="col-span-2 text-right">구매 가격(원)</div>
                        <div class="col-span-2 text-right">구매 중량</div>
                        <div class="col-span-2 text-right">사용 중량</div>
                        <div class="col-span-1 text-right">원가</div>
                        <div class="col-span-1"></div>
                    </div>
                    <div id="pricing-rows" class="space-y-3">
                        <!-- Dynamic rows here -->
                    </div>

                    <div class="grid grid-cols-2 gap-6 mt-12 pt-8 border-t">
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                                <span class="text-sm font-bold text-gray-600">인분 수</span>
                                <input type="number" id="servings" value="2" min="1" onchange="calcTotal()"
                                    class="w-16 bg-transparent text-right font-bold text-xl outline-none focus:text-red-600">
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                                <span class="text-sm font-bold text-gray-600">마진율 (%)</span>
                                <input type="number" id="margin" value="30" min="0" max="99" onchange="calcTotal()"
                                    class="w-16 bg-transparent text-right font-bold text-xl outline-none focus:text-red-600">
                            </div>
                        </div>
                        <div
                            class="bg-red-600 text-white rounded-3xl p-6 flex flex-col justify-between shadow-xl shadow-red-100">
                            <div class="space-y-1">
                                <p class="text-xs font-bold opacity-75">권장 판매가 (1인분)</p>
                                <h3 id="suggested-price" class="text-3xl font-black">0원</h3>
                            </div>
                            <div class="text-[10px] opacity-75 font-medium border-t border-white/20 pt-3">
                                <p>총 원가: <span id="total-cost">0</span>원</p>
                                <p>1인분 원가의 마진을 포함한 가격입니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Match -->
        <div id="content-match" class="hidden space-y-8">
            <div class="card p-8">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 bg-orange-50 text-orange-600 rounded-xl flex items-center justify-center">
                        <i data-lucide="refrigerator" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">보유 재료 매칭</h2>
                        <p class="text-sm text-gray-500">넣어둔 재료로 바로 만들 수 있는 레시피를 찾습니다.</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="relative group">
                        <input type="text" id="match-input"
                            class="w-full pl-6 pr-24 py-5 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-red-500 focus:bg-white transition-all text-lg font-medium"
                            placeholder="냉장고에 무엇이 있나요? (예: 두부)" onkeypress="if(event.key==='Enter') addMatchIng()">
                        <button onclick="addMatchIng()"
                            class="absolute right-3 top-3 px-6 py-2.5 bg-gray-900 text-white rounded-xl font-bold hover:bg-black transition-all">
                            추가
                        </button>
                    </div>

                    <div class="flex flex-wrap gap-2 items-center">
                        <span class="text-xs font-bold text-gray-400 mr-2 uppercase tracking-widest">고기/단백질:</span>
                        <button onclick="quickAdd('돼지고기')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">돼지고기</button>
                        <button onclick="quickAdd('소고기')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">소고기</button>
                        <button onclick="quickAdd('닭고기')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">닭고기</button>
                        <button onclick="quickAdd('계란')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">계란</button>
                        <button onclick="quickAdd('두부')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">두부</button>
                        <button onclick="quickAdd('참치')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">참치</button>
                    </div>
                    <div class="flex flex-wrap gap-2 items-center">
                        <span class="text-xs font-bold text-gray-400 mr-2 uppercase tracking-widest">야채/기타:</span>
                        <button onclick="quickAdd('양파')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">양파</button>
                        <button onclick="quickAdd('대파')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">대파</button>
                        <button onclick="quickAdd('마늘')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">마늘</button>
                        <button onclick="quickAdd('감자')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">감자</button>
                        <button onclick="quickAdd('당근')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">당근</button>
                        <button onclick="quickAdd('김치')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">김치</button>
                        <button onclick="quickAdd('어묵')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">어묵</button>
                    </div>
                    <div class="flex flex-wrap gap-2 items-center">
                        <span class="text-xs font-bold text-gray-400 mr-2 uppercase tracking-widest">양념류:</span>
                        <button onclick="quickAdd('고추장')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">고추장</button>
                        <button onclick="quickAdd('된장')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">된장</button>
                        <button onclick="quickAdd('간장')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">간장</button>
                        <button onclick="quickAdd('설탕')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">설탕</button>
                        <button onclick="quickAdd('고춧가루')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">고춧가루</button>
                        <button onclick="quickAdd('참기름')"
                            class="text-xs px-3 py-1.5 bg-white border border-gray-200 rounded-lg font-medium text-gray-600 hover:border-red-500 hover:text-red-500 transition-all">참기름</button>
                    </div>

                    <div id="match-tags"
                        class="flex flex-wrap gap-2 min-h-[100px] p-6 bg-gray-50/50 rounded-2xl border-2 border-dashed border-gray-100 items-start">
                        <div class="w-full text-center py-6 text-gray-400">
                            <p class="text-sm font-medium">재료를 입력하면 여기에 표시됩니다.</p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-3 pt-4">
                        <button onclick="resetMatch()"
                            class="px-6 py-3 text-sm font-bold text-gray-400 hover:text-gray-600">전체 삭제</button>
                        <button onclick="findMatch()"
                            class="px-10 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 shadow-lg shadow-red-100">레시피
                            검색</button>
                    </div>
                </div>
            </div>

            <div id="match-results" class="hidden space-y-6">
                <div class="flex items-center justify-between border-b pb-4">
                    <h3 class="text-lg font-bold text-gray-900">추천 레시피</h3>
                    <span id="match-count" class="text-sm font-bold text-red-600">0개 발견</span>
                </div>
                <div id="match-cards" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Recipe cards here -->
                </div>
            </div>

            <div id="no-match" class="hidden card p-16 text-center space-y-4">
                <i data-lucide="search-x" class="w-12 h-12 text-gray-300 mx-auto"></i>
                <h3 class="text-xl font-bold text-gray-900">일치하는 레시피가 없습니다</h3>
                <p class="text-gray-500">다른 재료를 더 추가해 보세요.</p>
            </div>
        </div>
    </main>

    <!-- Modal for Detail -->
    <div id="modal" class="modal">
        <div class="modal-content shadow-2xl">
            <div class="flex justify-between items-start mb-6">
                <div id="modal-header"></div>
                <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-all">
                    <i data-lucide="x" class="w-6 h-6 text-gray-400"></i>
                </button>
            </div>
            <div id="modal-body" class="space-y-6"></div>
            <div class="mt-8 pt-6 border-t flex justify-end">
                <button onclick="closeModal()"
                    class="px-8 py-2.5 bg-gray-900 text-white rounded-xl font-bold">닫기</button>
            </div>
        </div>
    </div>

    <script>
        // Init Icons
        lucide.createIcons();

        // Database - 대폭 확장된 15개 추천 레시피
        const db = [
            { id: 1, title: "김치찌개", user: "백종원", desc: "한국인의 소울푸드, 시원하고 얼큰한 맛", time: "30분", level: "쉬움", ings: ["김치", "돼지고기", "두부", "대파", "양파", "고춧가루", "마늘", "국간장", "된장"], steps: ["김치는 한입 크기로, 돼지고기는 큼직하게 썰어 준비합니다.", "냄비에 돼지고기, 김치, 고춧가루, 마늘을 넣고 고기 겉면이 익을 때까지 충분히 볶습니다.", "쌀뜨물 800ml를 붓고 된장 1/2큰술을 풀어 풍미를 더합니다.", "중불에서 15분 이상 푹 끓여 김치가 부드러워지게 합니다.", "두부, 대파, 양파를 넣고 국간장으로 간을 맞춘 뒤 5분 더 끓여 마무리합니다."], tip: "된장을 한 스푼 넣으면 풍미가 살아나요", youtubeId: "YIms7_XwWzY" },
            { id: 2, title: "된장찌개", user: "성시경", desc: "구수한 된장과 신선한 야채의 조화", time: "20분", level: "쉬움", ings: ["된장", "두부", "호박", "감자", "대파", "마늘", "청양고추", "멸치육수"], steps: ["멸치 다시마 육수 500ml를 진하게 우려낸 뒤 된장 2~3큰술을 풉니다.", "감자, 호박 등 단단한 야채를 먼저 넣고 센 불에서 끓입니다.", "마늘 1/2큰술과 고춧가루를 넣어 칼칼한 맛을 조절합니다.", "두부, 대파, 청양고추를 넣고 약불에서 은은하게 5분 더 졸여 깊은 맛을 냅니다."], tip: "멸치 육수를 진하게 내는 것이 포인트", youtubeId: "R-vX_c-67_o" },
            { id: 3, title: "제육볶음", user: "백종원", desc: "매콤달콤 불맛 가득한 기사식당 스타일", time: "25분", level: "보통", ings: ["돼지고기", "고추장", "고춧가루", "간장", "설탕", "대파", "양파", "마늘", "참기름", "후추"], steps: ["고추장, 고춧가루, 간장, 설탕, 마늘로 만든 양념에 고기를 20분간 재웁니다.", "팬을 뜨겁게 달군 뒤 고기를 넣고 강불에서 빠르게 볶아 불맛을 입립나.", "고기가 익으면 양파와 대파를 넣고 야채의 숨이 살짝 죽을 때까지만 볶습니다.", "마지막으로 참기름과 통깨를 뿌려 고소한 향을 더해 완성합니다."], tip: "배즙을 넣으면 고기가 연해져요", youtubeId: "wWfhZJzQLsM" },
            { id: 4, title: "계란말이", user: "백종원", desc: "실패 없는 백선생님표 달걀말이 비법", time: "15분", level: "보통", ings: ["계란", "대파", "당근", "설탕", "소금", "식용유"], steps: ["볼에 계란 5개를 풀고 설탕과 소금 1/3큰술씩 넣어 잘 섞어줍니다.", "대파와 당근을 잘게 다져 넣고 알끈이 없도록 충분히 풀어줍니다.", "약불로 달군 팬에 식용유를 두르고 계란물을 얇게 펼칩니다.", "바닥면이 익기 시작하면 끝에서부터 천천히 말아준 뒤 빈 공간에 다시 계란물을 붓습니다.", "이 과정을 3~4번 반복하여 두툼하게 만든 뒤 사방을 노릇하게 익혀 완성합니다."], tip: "설탕을 약간 넣으면 훨씬 부드러워집니다.", youtubeId: "0-S_m5mX_7I" },
            { id: 5, title: "소불고기", user: "백종원", desc: "부드러운 소고기와 달콤한 양념의 만남", time: "30분", level: "보통", ings: ["소고기", "간장", "설탕", "물엿", "참기름", "마늘", "양파", "대파", "표고버섯", "후추"], steps: ["소고기는 키친타월로 핏물을 닦고 먹기 좋은 크기로 썰어줍니다.", "간장 4, 설탕 2, 참기름 1, 마늘 1 비율의 양념에 고기를 버무려 30분간 숙성합니다.", "양파, 표고버섯, 대파를 큼직하게 썰어 준비한 고기와 섞어줍니다.", "팬을 강불로 예열한 뒤 고기를 넣고 뭉치지 않게 풀어가며 빠르게 볶습니다.", "고기가 다 익으면 후추와 통깨를 뿌려 마무리합니다."], tip: "배즙이나 사과즙을 넣으면 고기가 훨씬 연해집니다", youtubeId: "g95D5mG6f8g" },
            { id: 6, title: "닭볶음탕", user: "백종원", desc: "매콤한 양념이 쏙 배어든 밥도둑", time: "45분", level: "보통", ings: ["닭고기", "감자", "당근", "양파", "대파", "고춧가루", "고추장", "간장", "설탕", "마늘"], steps: ["닭은 끓는 물에 소주나 월계수잎을 넣고 5분간 데쳐 불순물을 제거합니다.", "냄비에 닭과 물 800ml, 설탕 2큰술을 먼저 넣고 끓여 고기를 연하게 만듭니다.", "고추장 1, 고춧가루 3, 간장 4, 마늘 1 비율의 양념장과 감자, 당근을 넣습니다.", "중불에서 감자가 익을 때까지 20분 이상 푹 졸여 양념이 배게 합니다.", "양파와 대파를 넣고 한소끔 더 끓여 국물이 걸쭉해지면 완성됩니다."], tip: "설탕을 먼저 넣어야 고기가 부드러워지고 양념이 잘 배요", youtubeId: "qjC7XGZ5V60" },
            { id: 7, title: "순두부찌개", user: "백종원", desc: "바지락 없이도 맛있는 매콤 순두부", time: "15분", level: "쉬움", ings: ["순두부", "돼지고기(간것)", "고춧가루", "간장", "소금", "대파", "마늘", "식용유", "참기름", "계란"], steps: ["팬에 식용유와 참기름을 두르고 대파와 고추장, 고춧가루를 볶아 고추기름을 냅니다.", "다진 돼지고기를 넣고 수분이 날아갈 때까지 충분히 볶아 고소함을 살립니다.", "물 400ml와 간장을 넣고 끓어오르면 순두부를 큼직하게 떼어 넣습니다.", "소금으로 간을 맞추고 대파와 청양고추를 넣어 시원한 맛을 줍니다.", "마지막에 계란 노란자를 올리고 불을 꺼 여열로 익힙니다."], tip: "고추기름을 충분히 내는 것이 핵심입니다", youtubeId: "t16xI56L22w" },
            { id: 8, title: "오므라이스", user: "백종원", desc: "분식집 스타일의 추억의 맛", time: "20분", level: "보통", ings: ["밥", "계란", "양파", "당근", "햄", "케첩", "진간장", "식초", "버터", "설탕"], steps: ["팬에 버터를 두르고 다진 양파, 당근, 햄을 충분히 볶아줍니다.", "케첩 3, 간장 1, 설탕 1, 식초 1/2큰술을 넣어 소스를 걸쭉하게 끓입니다.", "소스에 밥을 넣고 밥알이 뭉치지 않게 골고루 비벼가며 볶아줍니다.", "다른 팬에 계란 2개를 풀어 넓게 부친 뒤 볶음밥을 감싸듯이 올립니다.", "그릇에 담고 취향에 따라 케첩이나 소스를 곁들여 완성합니다."], tip: "우스터 소스 대신 간장과 식초를 섞어도 맛있어요", youtubeId: "6qO_L8h_5_A" },
            { id: 9, title: "떡볶이", user: "백종원", desc: "학교 앞 시장 떡볶이의 황금 레시피", time: "20분", level: "쉬움", ings: ["떡볶이떡", "사각어묵", "대파", "고추장", "고춧가루", "설탕", "진간장", "물"], steps: ["떡은 찬물에 헹궈 준비하고 사각어묵은 한입 크기로, 대파는 길쭉하게 썹니다.", "냄비에 물 500ml와 설탕 2, 고추장 1, 간장 2, 고춧가루 1큰술을 넣고 끓입니다.", "떡과 어묵을 넣고 국물이 반으로 줄어들 때까지 중불에서 졸입니다.", "대파를 듬뿍 넣고 국물이 걸쭉해지면 완성입니다."], tip: "고운 고춧가루를 쓰면 색이 훨씬 예쁩니다", youtubeId: "t4Es8mSutS0" },
            { id: 10, title: "알리오올리오", user: "성시경", desc: "마늘과 올리브유만으로 내는 풍미", time: "15분", level: "쉬움", ings: ["파스타면", "마늘", "올리브유", "페페론치노", "소금", "파슬리가루", "치즈가루"], steps: ["냄비에 물 1.5L와 소금 1큰술을 넣고 파스타면을 8분간 삶습니다.", "팬에 올리브유를 넉넉히 두르고 편마늘과 페페론치노를 약불에서 익힙니다.", "마늘이 황금색으로 변하면 삶은 면과 면수 한 국자를 넣습니다.", "팬을 힘차게 흔들며 오일과 면수가 섞여 뽀얀 소스가 되도록 유화시킵니다.", "마지막으로 소금과 후추로 간을 더해 완성합니다."], tip: "팬을 흔들어 면수와 오일이 충분히 섞이게 하세요", youtubeId: "YfM6T2QosjY" },
            { id: 11, title: "미역국", user: "백종원", desc: "생일 필수 코스, 진하고 부드러운 국물", time: "40분", level: "쉬움", ings: ["미역", "소고기(국거리)", "참기름", "국간장", "멸치액젓", "다진마늘"], steps: ["마른 미역은 물에 20분간 불린 뒤 물기를 짜고 먹기 좋게 자릅니다.", "팬에 참기름을 두르고 소고기를 먼저 볶다가 미역을 넣고 함께 충분히 볶습니다.", "물 1L를 붓고 다진 마늘 1큰술과 국간장을 넣어 푹 끓입니다.", "부족한 간은 멸치액젓이나 까나리액젓 1큰술로 맞추면 훨씬 깊은 맛이 납니다.", "약불에서 30분 이상 오래 끓여 미역이 부드러워지면 완성입니다."], tip: "액젓을 한 스푼 넣으면 감칠맛이 폭발합니다", youtubeId: "mN9Xz0V6-is" },
            { id: 12, title: "참치김치볶음밥", user: "백종원", desc: "반찬 없을 때 최고, 5분 완성 볶음밥", time: "10분", level: "쉬움", ings: ["밥", "김치", "참치캔", "대파", "식용유", "간장", "설탕", "참기름", "계란"], steps: ["대파를 송송 썰어 식용유에 볶아 파기름을 충분히 냅니다.", "김치는 잘게 썰고 참치는 기름을 빼서 준비한 뒤 함께 충분히 볶습니다.", "진간장 1큰술을 팬 가장자리에 둘러 태우듯 불맛을 입힙니다.", "밥을 넣고 양념과 잘 섞이게 볶은 뒤 참기름 1큰술으로 마무리합니다.", "반숙 계란 프라이를 올려 노른자를 터뜨려 먹으면 환상적입니다."], tip: "간장을 팬 가장자리에 떨궈 불맛을 내세요", youtubeId: "MhXvStk7_hM" },
            { id: 13, title: "카레라이스", user: "하루한끼", desc: "한 솥 끓여두면 든든한 일본식 카레", time: "30분", level: "쉬움", ings: ["카레가루", "돼지고기", "감자", "양파", "당근", "버터"], steps: ["고기, 감자, 당근, 양파를 1.5cm 크기의 정육면체로 썹니다.", "팬에 식용유를 두르고 양파가 투명해질 때까지 충분히 볶아 단맛을 냅니다.", "고기와 다른 야채들을 넣고 고기 겉면이 익을 때까지 볶습니다.", "물 700ml를 붓고 야채가 완전히 익을 때까지 푹 끓입니다.", "불을 약하게 줄이고 카레가루를 조금씩 넣어가며 뭉치지 않게 풀어줍니다."], tip: "양파를 오래 볶을수록 깊은 맛이 납니다", youtubeId: "G7mB8J8o7qU" },
            { id: 14, title: "감자전", user: "성시경", desc: "바삭하고 고소한 감자 100%의 맛", time: "20분", level: "쉬움", ings: ["감자", "소금", "식용유", "양파"], steps: ["감자는 껍질을 깎아 강판에 간 뒤 체에 걸러 건더기와 물을 분리합니다.", "받아둔 물은 10분간 그대로 두어 아래쪽에 하얀 전분이 가라앉게 합니다.", "웃물을 따라버리고 남은 전분과 감자 건더기, 소금을 섞어 반죽합니다.", "팬에 반죽을 얇게 펴고 중불에서 바삭하게 부쳐냅니다.", "노릇하게 익으면 간장 소스를 곁들여 완성합니다."], tip: "양파를 같이 갈아 넣으면 갈변을 막을 수 있어요", youtubeId: "J2_688O3k5Q" },
            { id: 15, title: "오이무침", user: "백종원", desc: "아삭아삭 입맛 돋우는 즉석 반찬", time: "10분", level: "쉬움", ings: ["오이", "양파", "고춧가루", "설탕", "간장", "식초", "마늘", "참기름"], steps: ["오이는 소금으로 문질러 씻은 뒤 동그란 모양으로 얇게 썹니다.", "볼에 고춧가루, 설탕, 간장, 소금과 다진 마늘을 섞어 양념을 만듭니다.", "오이와 채 썬 양파를 양념에 넣고 손으로 가볍게 버러무립니다.", "마지막에 식초 1큰술과 참기름, 통깨를 넣어 아삭한 맛을 살려 마무리합니다."], tip: "먹기 바로 직전에 무쳐야 아삭함이 살아있습니다", youtubeId: "gB5OAnS8kU4" }
        ];

        // State
        let currentTab = 'extractor';
        let matchIngs = [];

        // Tab Switching
        function switchTab(tag) {
            ['extractor', 'pricing', 'match'].forEach(t => {
                document.getElementById('content-' + t).classList.add('hidden');
                document.getElementById('tab-' + t).className = 'flex-1 py-3 px-4 rounded-xl text-sm transition-all flex items-center justify-center gap-2 tab-inactive';
            });
            document.getElementById('content-' + tag).classList.remove('hidden');
            document.getElementById('tab-' + tag).className = 'flex-1 py-3 px-4 rounded-xl text-sm transition-all flex items-center justify-center gap-2 tab-active';
            currentTab = tag;
            lucide.createIcons();
        }

        // AI Generation
        async function generateRecipe() {
            const input = document.getElementById('ai-ingredients').value;
            if (!input) return alert('재료를 입력해 주세요.');

            const btn = document.getElementById('generate-btn');
            const loading = document.getElementById('ai-loading');
            const result = document.getElementById('ai-result');
            const content = document.getElementById('ai-recipe-content');

            btn.disabled = true;
            loading.classList.remove('hidden');
            result.classList.add('hidden');

            try {
                const res = await fetch('/generate_recipe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ingredients: input, count: 1 })
                });
                const data = await res.json();

                // Simple Markdown-ish to HTML
                let html = data.recipe.replace(/### (.*?)\n/g, '<h2 class="text-2xl font-bold mt-6 mb-4">$1</h2>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-gray-900">$1</strong>')
                    .replace(/- (.*?)\n/g, '<li class="ml-4 mb-2">$1</li>')
                    .replace(/\n\n/g, '<div class="h-4"></div>')
                    .replace(/\n/g, '<br>');

                content.innerHTML = html + `
                    <div class="mt-8 pt-6 border-t">
                        <div class="flex items-center gap-2 text-red-600 mb-4">
                            <i data-lucide="play-circle" class="w-5 h-5"></i>
                            <span class="text-sm font-black">관련 영상 찾아보기</span>
                        </div>
                        <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(data.recipe.split('\n')[0].replace('#', '').trim() + ' 레시피')}" 
                           target="_blank"
                           class="flex items-center justify-center gap-2 w-full py-4 bg-white border-2 border-red-100 rounded-2xl text-red-600 font-bold hover:bg-red-50 transition-all shadow-sm">
                            <i data-lucide="youtube" class="w-5 h-5"></i>
                            이 레시피 유튜브 영상 검색하기
                        </a>
                    </div>
                `;
                result.classList.remove('hidden');
                lucide.createIcons();
                result.scrollIntoView({ behavior: 'smooth' });
            } catch (e) {
                alert('연결 오류가 발생했습니다.');
            } finally {
                btn.disabled = false;
                loading.classList.add('hidden');
            }
        }

        // Match Logic
        function addMatchIng() {
            const val = document.getElementById('match-input').value.trim();
            if (!val) return;
            if (matchIngs.includes(val)) return alert('이미 추가된 재료입니다.');
            matchIngs.push(val);
            document.getElementById('match-input').value = '';
            renderMatchTags();
        }

        function quickAdd(v) {
            if (matchIngs.includes(v)) return;
            matchIngs.push(v);
            renderMatchTags();
        }

        function removeIng(v) {
            matchIngs = matchIngs.filter(i => i !== v);
            renderMatchTags();
        }

        function resetMatch() {
            if (!confirm('모든 재료를 삭제하시겠습니까?')) return;
            matchIngs = [];
            renderMatchTags();
            document.getElementById('match-results').classList.add('hidden');
            document.getElementById('no-match').classList.add('hidden');
        }

        function renderMatchTags() {
            const container = document.getElementById('match-tags');
            if (matchIngs.length === 0) {
                // 추천 영상 섹션 추가 (DB 상위 4개 추출)
                const recommends = db.slice(0, 4);
                container.innerHTML = `
                    <div class="w-full space-y-4">
                        <div class="flex items-center gap-2 text-gray-900 mb-2">
                            <i data-lucide="sparkles" class="w-5 h-5 text-red-500"></i>
                            <span class="text-sm font-black italic">Mise 추천 조리 영상</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${recommends.map(r => `
                                <div class="group cursor-pointer" onclick="showDetail(${r.id}, true)">
                                    <div class="relative aspect-video rounded-xl overflow-hidden mb-2 bg-gray-200 shadow-sm group-hover:shadow-md transition-all">
                                        <img src="https://img.youtube.com/vi/${r.youtubeId}/mqdefault.jpg" class="w-full h-full object-cover">
                                        <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 flex items-center justify-center transition-all">
                                            <i data-lucide="play" class="w-8 h-8 text-white opacity-80 group-hover:scale-110 transition-all"></i>
                                        </div>
                                    </div>
                                    <p class="text-[11px] font-bold text-gray-800 line-clamp-1">${r.title}</p>
                                    <p class="text-[9px] text-gray-400">${r.user}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            container.innerHTML = matchIngs.map(i => `
                <div class="ingredient-tag user font-bold">
                    <span>${i}</span>
                    <button onclick="removeIng('${i}')" class="p-0.5 hover:bg-blue-200 rounded-full transition-all">
                        <i data-lucide="x" class="w-3.5 h-3.5"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function findMatch() {
            if (matchIngs.length === 0) return alert('재료를 먼저 입력해 주세요.');

            const results = db.map(r => {
                const matched = r.ings.filter(ing => matchIngs.some(u => u.includes(ing) || ing.includes(u)));
                const score = Math.round((matched.length / r.ings.length) * 100);
                return { ...r, matched, score };
            }).filter(r => r.score >= 20).sort((a, b) => b.score - a.score);

            const display = document.getElementById('match-results');
            const noRes = document.getElementById('no-match');
            const container = document.getElementById('match-cards');

            if (results.length > 0) {
                display.classList.remove('hidden');
                noRes.classList.add('hidden');
                document.getElementById('match-count').innerText = results.length + '개 발견';
                container.innerHTML = results.map(r => `
                    <div class="card p-6 flex flex-col justify-between cursor-pointer group hover:border-red-500/50" onclick="showDetail(${r.id})">
                        <div>
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-2">
                                    <h4 class="text-lg font-bold text-gray-900 group-hover:text-red-600 transition-colors">${r.title}</h4>
                                    ${r.youtubeId ? `
                                        <div class="flex items-center gap-1 px-2 py-0.5 bg-red-600 text-white rounded-md text-[9px] font-black animate-pulse">
                                            <i data-lucide="play" class="w-2.5 h-2.5 fill-current border-none"></i> REC
                                        </div>
                                    ` : ''}
                                </div>
                                <span class="bg-red-50 text-red-600 px-3 py-1 rounded-lg text-xs font-black ring-1 ring-red-100">${r.score}%</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-4 line-clamp-2">${r.desc}</p>
                            <div class="flex flex-wrap gap-1 mb-6">
                                ${r.ings.map(ing => {
                    const isMatch = r.matched.includes(ing);
                    return `<span class="text-[10px] px-2 py-0.5 rounded ${isMatch ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-gray-100 text-gray-400 border border-gray-200'} font-bold">${ing}</span>`;
                }).join('')}
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-4 border-t gap-3">
                            <span class="text-xs text-gray-400 font-bold flex items-center gap-1">
                                <i data-lucide="clock" class="w-3 h-3"></i> ${r.time}
                            </span>
                            <div class="flex gap-2">
                                ${r.youtubeId ? `
                                    <button onclick="event.stopPropagation(); showDetail(${r.id}, true)" class="flex-1 px-3 py-2 bg-red-50 text-red-600 rounded-lg text-xs font-black flex items-center gap-1 hover:bg-red-600 hover:text-white transition-all">
                                        <i data-lucide="youtube" class="w-3.5 h-3.5"></i> 영상 시청
                                    </button>
                                ` : ''}
                                <button class="px-3 py-2 bg-gray-900 text-white rounded-lg text-xs font-bold flex items-center gap-1 hover:bg-black transition-all">
                                    상세보기 <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
                display.scrollIntoView({ behavior: 'smooth' });
            } else {
                display.classList.add('hidden');
                noRes.classList.remove('hidden');
            }
        }

        // Modal functions
        function showDetail(id, autoplay = false) {
            const item = db.find(r => r.id === id);
            const header = document.getElementById('modal-header');
            const body = document.getElementById('modal-body');

            header.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-red-50 rounded-2xl flex items-center justify-center text-red-600">
                        <i data-lucide="utensils-crossover" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black text-gray-900 leading-tight">${item.title}</h2>
                        <p class="text-red-500 font-bold text-xs flex items-center gap-1">
                            <i data-lucide="user" class="w-3 h-3"></i> ${item.user || 'Mise 추천 레시피'}
                        </p>
                    </div>
                </div>
            `;

            body.innerHTML = `
                ${item.youtubeId ? `
                <div class="space-y-4 mb-8">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2 text-red-600">
                            <i data-lucide="play-circle" class="w-5 h-5 animate-bounce"></i>
                            <span class="text-sm font-black uppercase tracking-tighter">추천 조리 영상 시청 중</span>
                        </div>
                        <a href="https://www.youtube.com/watch?v=${item.youtubeId}" target="_blank" 
                           class="text-[10px] font-bold text-gray-400 hover:text-red-600 flex items-center gap-1">
                           YouTube 앱으로 보기 <i data-lucide="external-link" class="w-2.5 h-2.5"></i>
                        </a>
                    </div>
                    <div class="w-full aspect-video">
                        <iframe class="w-full h-full" src="https://www.youtube.com/embed/viM1rOvhh_w" 
                            title="YouTube video player" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen></iframe>
                    </div>
                </div>
                ` : ''}
                <div class="flex gap-4 text-xs font-bold text-gray-400 uppercase tracking-widest">
                    <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3.5 h-3.5"></i> ${item.time}</span>
                    <span class="flex items-center gap-1"><i data-lucide="bar-chart" class="w-3.5 h-3.5"></i> ${item.level}</span>
                </div>
                <div class="space-y-4">
                    <h4 class="font-bold text-gray-900 flex items-center gap-2">
                        <i data-lucide="shopping-basket" class="w-4 h-4 text-red-500"></i> 준비물 및 주문
                    </h4>
                    <div class="grid grid-cols-2 gap-2">
                        ${item.ings.map(i => {
                const isMatch = matchIngs.some(u => u.includes(i) || i.includes(u));
                return `
                                <div class="flex items-center justify-between p-3 rounded-xl border ${isMatch ? 'bg-green-50 border-green-100' : 'bg-gray-50 border-gray-100'}">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="${isMatch ? 'check-circle-2' : 'help-circle'}" class="w-4 h-4 ${isMatch ? 'text-green-500' : 'text-gray-300'}"></i>
                                        <span class="text-sm font-medium ${isMatch ? 'text-green-700' : 'text-gray-500'}">${i}</span>
                                    </div>
                                    ${!isMatch ? `
                                        <a href="https://www.coupang.com/np/search?q=${encodeURIComponent(i)}" target="_blank"
                                           class="text-[10px] bg-white border border-gray-200 px-2 py-1 rounded-lg font-bold text-gray-400 hover:text-red-500 hover:border-red-500 transition-all shadow-sm flex items-center gap-1">
                                            주문 <i data-lucide="shopping-cart" class="w-2.5 h-2.5"></i>
                                        </a>
                                    ` : ''}
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>
                <div class="space-y-4">
                    <h4 class="font-bold text-gray-900">조리 순서</h4>
                    <ol class="space-y-3">
                        ${item.steps.map((s, idx) => `
                            <li class="flex gap-4 items-start">
                                <span class="bg-red-50 text-red-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-black shrink-0">${idx + 1}</span>
                                <p class="text-gray-700 leading-relaxed">${s}</p>
                            </li>
                        `).join('')}
                    </ol>
                </div>
                <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 italic">
                    <p class="text-sm text-gray-600"><strong class="not-italic text-red-600 mr-2">TIP</strong> ${item.tip}</p>
                </div>
            `;

            document.getElementById('modal').classList.add('active');
            lucide.createIcons();
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Pricing logic
        let pricingId = 0;
        function addPricingRow() {
            const container = document.getElementById('pricing-rows');
            const id = pricingId++;
            const div = document.createElement('div');
            div.className = 'grid grid-cols-12 gap-4 items-center animate-in fade-in slide-in-from-top-2 duration-300';
            div.id = 'row-' + id;
            div.innerHTML = `
                <div class="col-span-4">
                    <input type="text" placeholder="예: 소고기" class="w-full bg-gray-50 p-3 rounded-xl outline-none border border-transparent focus:border-red-500 text-sm font-medium">
                </div>
                <div class="col-span-2">
                    <input type="number" value="10000" onchange="calcTotal()" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-right text-sm">
                </div>
                <div class="col-span-2">
                    <input type="text" value="1000g" onchange="calcTotal()" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-right text-sm">
                </div>
                <div class="col-span-2">
                    <input type="text" value="200g" onchange="calcTotal()" class="w-full bg-gray-50 p-3 rounded-xl outline-none text-right text-sm">
                </div>
                <div class="col-span-1 text-right text-sm font-bold text-gray-900 row-cost">0원</div>
                <div class="col-span-1 text-center">
                    <button onclick="removeRow(${id})" class="text-gray-300 hover:text-red-500 transition-all"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
            `;
            container.appendChild(div);
            lucide.createIcons();
            calcTotal();
        }

        function removeRow(id) {
            document.getElementById('row-' + id).remove();
            calcTotal();
        }

        function parse(s) {
            const m = s.match(/(\d+)/);
            if (!m) return 0;
            let v = parseInt(m[1]);
            if (s.includes('kg') || (s.includes('l') && !s.includes('ml'))) v *= 1000;
            return v;
        }

        function calcTotal() {
            const rows = document.querySelectorAll('#pricing-rows > div');
            let total = 0;
            rows.forEach(r => {
                const ins = r.querySelectorAll('input');
                const price = parseInt(ins[1].value) || 0;
                const buy = parse(ins[2].value);
                const use = parse(ins[3].value);
                let cost = 0;
                if (buy > 0) cost = Math.round((price / buy) * use);
                r.querySelector('.row-cost').innerText = cost.toLocaleString() + '원';
                total += cost;
            });

            const s = parseInt(document.getElementById('servings').value) || 1;
            const m = parseInt(document.getElementById('margin').value) || 0;
            const per = Math.round(total / s);
            const sug = Math.round(per / (1 - m / 100));

            document.getElementById('total-cost').innerText = total.toLocaleString();
            document.getElementById('suggested-price').innerText = sug.toLocaleString() + '원';
        }

        // Initial Load
        window.onload = () => {
            addPricingRow();
        };
    </script>
</body>

</html>